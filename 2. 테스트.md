# 테스트
테스트란 결국 내가 예상하고 의도했던 대로 코드가 정확히 동작하는지를 확인해서, 만든 코드를 확신할 수 있게 해주는 작업이다. 또한 테스트의 결과가 원하는 대로 
나오지 않는 경우에는 코드나 설계에 결함이 있음을 알 수 있다. 이를 통해 코드의 결함을 제거해가는 작업, 일명 디버깅을 거치게 되고, 결국 최종적으로 테스트가 
성공하면 모든 결함이 제거됐다는 확신을 얻을 수 있다.
<hr/>

### UserDaoTest 다시 보기
* 자바에서 가장 손쉽게 실행 가능한 main() 메소드를 이용한다.
* 테스트할 대상인 UserDao의 오브젝트를 가져와 메소드를 호출한다.
* 테스트에 사용할 입력 값(User 오브젝트)을 직접 코드에서 만들어 넣어준다.
* 테스트의 결과를 콘솔에 출력해준다.
* 각 단계의 작업이 에러 없이 끝나면 콘솔에 성공 메시지로 출력해준다.

> main() 메소드를 이용해 쉽게 테스트 수행을 가능하게 했다.
###### 웹을 통한 DAO 테스트 방법의 문제점
웹 화면을 통해 값을 입력하고, 기능을 수행하고, 결과를 확인하는 방법은 가장 흔히 쓰이는 방법이지만, DAO에 대한 테스트로서는 단점이 너무 많다. DAO뿐만 아니라 
서비스 클래스, 컨트롤러, JSP 뷰 등 모든 레이어의 기능을 다 만들고 나서야 테스트가 가능하다는 점이 가장 큰 문제다.
###### 작은 단위의 테스트
테스트하고자 하는 대상이 명확하다면 그 대상에만 집중해서 테스트하는 것이 바람직하다. 관심사의 분리라는 원리가 여기에도 적용된다.<br/>
> 작은 단위의 코드에 대해 테스트를 수행한 것을 **단위 테스트**라고 한다.<br/>
일반적으로 단위는 작을수록 좋다.
###### 자동수행 테스트 코드
UserDaoTest의 한 가지 특징은 테스트할 데이터가 코드를 통해 제공되고, 테스트 작업 역시 코드를 통해 자동으로 실행된다는 점이다. 테스트는 자동으로 수행되도록 
코드로 만들어지는 것이 중요하다.

자동으로 수행되는 테스트의 장점은 자주 반복할 수 있다는 것이다. 번거로운 작업이 없고 테스트를 빠르게 실행할 수 있기 때문에 언제든 코드를 수정하고 나서 
테스트를 해 볼 수 있다. 수정 때문에 다른 기능에 문제가 발생하는지 않는지 재빨리 확인하고, 성공한다면 마음에 확신을 얻을 수 있다.
###### 지속적인 개선과 점진적인 개발을 위한 테스트
테스트를 이용하면 새로운 기능도 기대한 대로 동작하는지 확인할 수 있을 뿐 아니라, 기존에 만들어뒀던 기능들이 새로운 기능을 추가하느라 수정한 코드에 
영향을 받지 않고 여전히 잘 동작하는지를 확인할 수도 있다.

#### UserDaoTest의 문제점
* 수동 확인 작업의 번거로움
  * UserDaoTest는 테스트를 수행하는 과정과 입력 데이터의 준비를 모두 자동으로 진행하도록 만들어졌다. 하지만 여전히 사람의 눈으로 확인하는 과정이 필요하다. 
  add()에서 User 정보를 DB에 등록하고, 이를 다시 get()을 이용해 가져왔을 때 입력한 값과 가져온 값이 일치하는지를 테스트 코드는 확인해주지 않는다. 단지 
  콘솔에 값만 출력해줄 뿐이다. 결국 그 콘솔에 나온 값을 보고 등록과 조회가 성공적으로 되고 있는지를 확인하는 건 사람의 책임이다.<br/>
  > 테스트 수행은 코드에 의해 자동으로 진행되긴 하지만 테스트의 결과를 확인하는 일은 사람의 책임이므로 완전히 자동으로 테스트되는 방법이라고 말할 수가 없다.
* 실행 작업의 번거로움
  * 아무리 간단히 실행 가능한 main() 메소드라고 하더라도 매번 그것을 실행하는 것은 제법 번거롭다. 만약 DAO가 수백개가 되고 그에 대한 main() 메소드도 
  그만큼 만들어진다면, 전체 기능을 테스트해보기 위해 main() 메소드를 수백 번 실행하는 수고가 필요하다.
<hr/>

### UserDaoTest 개선
모든 테스트는 성공과 실패의 두 가지 결과를 가질 수 있다. 또 테스트의 실패는 테스트가 진행되는 동안에 에러가 발생해서 실패하는 경우와, 테스트 작업 중에 에러가 발생하진 않았지만 그 결과가 기대한 것과 다르게 나오는 경우로 구분해볼 수 있다. 여기서 전자를 테스트 에러, 후자를 테스트 실패로 구분하자.
```
if(!user.getName().equals(user2.getName()) {
 System.out.println("테스트 실패 (name)");
}
else if (!user.getPassword().equals(user2.getPassword())) {
 System.out.println("테스트 실패 (password)");
}
else {
 System.out.println("조회 테스트 성공");
}
```
다음과 같이 개선해서 처음 add()에 전달한 User 오브젝트와 get()을 통해 가져오는 User 오브젝트의 값을 비교해서 일치하는지 확인한다.

#### 테스트의 효율적인 수행과 결과 관리
일정한 패턴을 가진 테스트를 만들 수 있고, 많은 테스트를 간단히 실행시킬 수 있으며, 테스트 결과를 종합해서 볼 수 있고, 테스트가 실패한 곳을 빠르게 찾을 수 있는 기능을 갖춘 테스트 지원 도구와 그에 맞는 테스트 작성 방법이 필요하다. mail() 메소드를 이용한 테스트 작성 방법만으로는 애플리케이션 규모가 커지고 테스트 개수가 많아지면 테스트를 수행하는 일이 점점 부담이 될 것이다.

###### JUnit 테스트로 전환
JUnit은 프레임워크다. 프레임워크는 개발자가 만든 클래스에 대한 제어 권한을 넘겨받아서 주도적으로 애플리케이션의 흐름을 제어한다. 개발자가 만든 클래스의 오브젝트를 생성하고 실행하는 일은 프레임워크에 의해 진행된다. 따라서 프레임 워크에서 동작하는 코드는 main() 메소드도 필요 없고 오브젝트를 만들어서 실행시키는 코드를 만들 필요도 없다.

###### 테스트 메소드 전환
JUnit 프레임워크가 요구하는 조건 두가지
* 메소드가 public으로 선언돼야 한다.
* 메서드에 @Test라는 애노테이션을 붙여준다.
```
public class UserDaoTest {
 @Test
 public void addAndGet() throws SQLException {
  ApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
  
  UserDao dao = context.getBean("userDao", UserDao.class);
  ...
 }
}
```
###### 검증 코드 전환
스태틱 메소드 assertThat
```
assertThat(user2.getName(), is(user.getName()));
```
assertThat() 메소드는 첫 번째 파라미터의 값을 뒤에 나오는 매처(macher)라고 불리는 조건으로 비교해서 일치하면 다음으로 넘어가고, 아니면 테스트가 실패하도록 만들어준다. is()는 매처의 일종으로 equals()로 비교해주는 기능을 가졌다.

> JUnit은 예외가 발생하거나 assertThat()에서 실패하지 않고 테스트 메소드의 실행이 완료되면 테스트가 성공했다고 인식한다. "테스트 성공"이라는 메시지를 굳이 출력할 필요는 없다.
###### JUnit 테스트 실행
스프링 컨테이너와 마찬가지로 JUnit 프레임워크도 자바 코드로 만들어진 프로그램이므로 어디선가 한 번은 JUnit 프레임워크를 시작시켜 줘야 한다. 어디에든 main() 메소드를 하나 추가하고, 그 안에 JUnitCore 클래스의 main 메소드를 호출해주는 간단한 코드를 넣어주면 된다. 메소드 파라미터에는 @Test 테스트 메소드를 가진 클래스의 이름을 넣어준다.
```
public static void main(String[] args) {
 JUnitCore.main("springbook.user.dao.UserDaoTest");
}
```
이 클래스를 실행하면 테스트를 실행하는 데 걸린 시간과 테스트 결과, 그리고 몇 개의 테스트 메소드가 실행됐는지를 알려준다. 

테스트가 실패하면 OK 대신 FAILURES!!라는 내용이 출력되고, 총 수행한 테스트 중에서 몇 개의 테스트가 실패했는지 보여준다. 출력된 메시지를 잘 살펴보면 실패한 테스트는 어떤 클래스의 어느 메소드이고, 실패의 이유는 어떠한 값을 원했는데 실행해보니 어떤 값이 나왔다는 것임을 알 수 있다.
<hr/>

### 개발자를 위한 테스팅 프레임워크 JUnit
